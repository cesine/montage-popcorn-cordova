(function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()})(function(){"use strict";function e(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function t(e){return"[object StopIteration]"===st(e)||e instanceof Q}function n(e,t){t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(lt)&&(e.stack=i(e.stack)+"\n"+lt+"\n"+i(t.stack))}function i(e){for(var t=e.split("\n"),n=[],i=0;t.length>i;++i){var o=t[i];a(o)||r(o)||n.push(o)}return n.join("\n")}function r(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.*):(\d+):\d+\)/.exec(e);if(!t)return!1;var n=t[1],i=t[2];return n===G&&i>=J&&pt>=i}function o(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,i){e=i[1].getFileName(),t=i[1].getLineNumber()},Error().stack,Error.prepareStackTrace=n,G=e,t}}function s(e){return y(e)}function l(){function e(e){n&&(t=y(e),tt(n,function(e,n){$(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0)}var t,n=[],i=[],r=rt(l.prototype),a=rt(c.prototype);return a.promiseDispatch=function(e,r,a){var o=et(arguments);n?(n.push(o),"when"===r&&a[1]&&i.push(a[1])):$(function(){t.promiseDispatch.apply(t,o)})},a.valueOf=function(){if(n)return a;var e=h(t);return d(e)&&(t=e),e},Error.captureStackTrace&&s.longStackJumpLimit>0&&(Error.captureStackTrace(a,l),a.stack=a.stack.substring(a.stack.indexOf("\n")+1)),r.promise=a,r.resolve=e,r.fulfill=function(t){e(b(t))},r.reject=function(t){e(_(t))},r.notify=function(e){n&&tt(i,function(t,n){$(function(){n(e)})},void 0)},r}function u(e){var t=l();return k(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function c(e,t,n,i,r){void 0===t&&(t=function(e){return _(Error("Promise does not support operation: "+e))});var a=rt(c.prototype);return a.promiseDispatch=function(n,i,r){var o;try{o=e[i]?e[i].apply(a,r):t.call(a,i,r)}catch(s){o=_(s)}n&&n(o)},n&&(a.valueOf=n),r&&(a.exception=i),a}function h(e){return d(e)?e.valueOf():e}function d(e){return e&&"function"==typeof e.promiseDispatch}function p(e){return e&&"function"==typeof e.then}function m(e){return!f(e)&&!v(e)}function f(e){return!p(h(e))}function v(e){return e=h(e),d(e)&&"exception"in e}function g(){ut||"undefined"==typeof window||window.Touch||!window.console||console.log("Should be empty:",ht),ut=!0}function _(e){var t=c({when:function(t){if(t){var n=nt(ct,this);-1!==n&&(ht.splice(n,1),ct.splice(n,1))}return t?t(e):this}},function(){return _(e)},function(){return this},e,!0);return g(),ct.push(t),ht.push(e),t}function b(e){return c({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return ot(e)}},void 0,function(){return e})}function y(e){return d(e)?e:(e=h(e),p(e)?w(e):b(e))}function w(e){var t=l();return $(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function E(e){return c({isDef:function(){}},function(t,n){return M(e,t,n)},function(){return h(e)})}function C(e,t,i,r){function a(e){try{return"function"==typeof t?t(e):e}catch(n){return _(n)}}function o(e){if("function"==typeof i){n(e,d);try{return i(e)}catch(t){return _(t)}}return _(e)}function u(e){return"function"==typeof r?r(e):e}var c=l(),h=!1,d=y(e);return $(function(){d.promiseDispatch(function(e){h||(h=!0,c.resolve(a(e)))},"when",[function(e){h||(h=!0,c.resolve(o(e)))}])}),d.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=u(e)}catch(i){if(n=!0,!s.onerror)throw i;s.onerror(i)}n||c.notify(t)}]),c.promise}function P(e,t,n){return C(e,function(e){return A(e).then(function(e){return t.apply(void 0,e)},n)},n)}function S(e){return function(){function n(e,n){var o;try{o=i[e](n)}catch(s){return t(s)?s.value:_(s)}return C(o,r,a)}var i=e.apply(this,arguments),r=n.bind(n,"send"),a=n.bind(n,"throw");return r()}}function T(e){throw new Q(e)}function D(e){return function(){return P([this,A(arguments)],function(t,n){return e.apply(t,n)})}}function M(e,t,n){var i=l();return $(function(){y(e).promiseDispatch(i.resolve,t,n)}),i.promise}function x(e){return function(t){var n=et(arguments,1);return M(t,e,n)}}function O(e,t){var n=et(arguments,2);return dt(e,t,n)}function L(e,t){return M(e,"apply",[void 0,t])}function k(e){var t=et(arguments,1);return L(e,t)}function I(e){var t=et(arguments,1);return function(){var n=t.concat(et(arguments));return M(e,"apply",[this,n])}}function A(e){return C(e,function(e){var t=0,n=l();return tt(e,function(i,r,a){f(r)?e[a]=h(r):(++t,C(r,function(i){e[a]=i,0===--t&&n.resolve(e)},n.reject))},void 0),0===t&&n.resolve(e),n.promise})}function z(e){return C(e,function(e){return e=it(e,y),C(A(it(e,function(e){return C(e,Z,Z)})),function(){return e})})}function j(e,t){return C(e,void 0,t)}function R(e,t){return C(e,void 0,void 0,t)}function N(e,t){return C(e,function(e){return C(t(),function(){return e})},function(e){return C(t(),function(){return _(e)})})}function B(e,t,i,r){var a=function(t){$(function(){if(n(t,e),!s.onerror)throw t;s.onerror(t)})},o=t||i||r?C(e,t,i,r):e;"object"==typeof process&&process&&process.domain&&(a=process.domain.bind(a)),j(o,a)}function F(e,t){var n=l(),i=setTimeout(function(){n.reject(Error("Timed out after "+t+" ms"))},t);return C(e,function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise}function q(e,t){void 0===t&&(t=e,e=void 0);var n=l();return C(e,void 0,void 0,n.notify),setTimeout(function(){n.resolve(e)},t),n.promise}function V(e,t){var n=et(t),i=l();return n.push(i.makeNodeResolver()),L(e,n).fail(i.reject),i.promise}function W(e){var t=et(arguments,1),n=l();return t.push(n.makeNodeResolver()),L(e,t).fail(n.reject),n.promise}function U(e){var t=et(arguments,1);return function(){var n=t.concat(et(arguments)),i=l();return n.push(i.makeNodeResolver()),L(e,n).fail(i.reject),i.promise}}function Y(e,t){var n=et(arguments,2);return function(){function i(){return e.apply(t,arguments)}var r=n.concat(et(arguments)),a=l();return r.push(a.makeNodeResolver()),L(i,r).fail(a.reject),a.promise}}function H(e,t,n){var i=et(n||[]),r=l();return i.push(r.makeNodeResolver()),dt(e,t,i).fail(r.reject),r.promise}function X(e,t){var n=et(arguments,2),i=l();return n.push(i.makeNodeResolver()),dt(e,t,n).fail(i.reject),i.promise}function K(e,t){return t?(e.then(function(e){$(function(){t(null,e)})},function(e){$(function(){t(e)})}),void 0):e}var G,$,J=o(),Z=function(){};"undefined"!=typeof process?$=process.nextTick:"function"==typeof setImmediate?$="undefined"!=typeof window?setImmediate.bind(window):setImmediate:function(){function e(){if(--a,++s>=r){s=0,r*=4;for(var e=o&&Math.min(o-1,r);e>a;)++a,t()}for(;o;){--o,n=n.next;var i=n.task;n.task=void 0,i()}s=0}var t,n={task:void 0,next:null},i=n,r=2,a=0,o=0,s=0;if($=function(e){i=i.next={task:e,next:null},++o>a&&r>a&&(++a,t())},"undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=e,t=function(){l.port2.postMessage(0)}}else t=function(){setTimeout(e,0)}}();var Q,et=e(Array.prototype.slice),tt=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(t=e(t,this[n],n));return t}),nt=e(Array.prototype.indexOf||function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return t;return-1}),it=e(Array.prototype.map||function(e,t){var n=this,i=[];return tt(n,function(r,a,o){i.push(e.call(t,a,o,n))},void 0),i}),rt=Object.create||function(e){function t(){}return t.prototype=e,new t},at=e(Object.prototype.hasOwnProperty),ot=Object.keys||function(e){var t=[];for(var n in e)at(e,n)&&t.push(n);return t},st=e(Object.prototype.toString);Q="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},s.longStackJumpLimit=1;var lt="From previous event:";s.nextTick=$,s.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(et(arguments,1)):e.resolve(n)}},s.promise=u,s.makePromise=c,c.prototype.then=function(e,t,n){return C(this,e,t,n)},c.prototype.thenResolve=function(e){return C(this,function(){return e})},c.prototype.thenReject=function(e){return C(this,function(){throw e})},tt(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(e,t){c.prototype[t]=function(){return s[t].apply(s,[this].concat(et(arguments)))}},void 0),c.prototype.toSource=function(){return""+this},c.prototype.toString=function(){return"[object Promise]"},s.nearer=h,s.isPromise=d,s.isPromiseAlike=p,s.isPending=m,s.isFulfilled=f,s.isRejected=v;var ut,ct=[],ht=[];"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var e=0;ht.length>e;e++){var t=ht[e];t&&t.stack!==void 0?console.warn("Unhandled rejected promise:",t.stack):console.warn("Unhandled rejected promise (no stack):",t)}}),s.reject=_,s.fulfill=b,s.resolve=y,s.master=E,s.when=C,s.spread=P,s.async=S,s["return"]=T,s.promised=D,s.dispatch=M,s.dispatcher=x,s.get=x("get"),s.set=x("set"),s["delete"]=s.del=x("delete");var dt=s.post=x("post");s.send=O,s.invoke=O,s.fapply=L,s["try"]=k,s.fcall=k,s.fbind=I,s.keys=x("keys"),s.all=A,s.allResolved=z,s["catch"]=s.fail=j,s.progress=R,s["finally"]=s.fin=N,s.done=B,s.timeout=F,s.delay=q,s.nfapply=V,s.nfcall=W,s.nfbind=U,s.denodeify=s.nfbind,s.nbind=Y,s.npost=H,s.nsend=X,s.ninvoke=s.nsend,s.nodeify=K;var pt=o();return s});