montageDefine("187c4e5","core/meta/blueprint-reference",{dependencies:["montage","core/promise","core/meta/blueprint","core/meta/binder","core/meta/remote-reference","core/meta/binder-reference","core/logger"],factory:function(e,t){"use strict";e("montage").Montage;var n=e("core/promise").Promise,r=e("core/meta/blueprint"),i=e("core/meta/binder"),a=e("core/meta/remote-reference").RemoteReference,o=e("core/meta/binder-reference").BinderReference;e("core/logger").logger("blueprint"),t.BlueprintReference=a.specialize({constructor:{value:function(){this.super()}},identifier:{get:function(){return this._reference||(this._reference=this.referenceFromValue(this._value)),["blueprint",this._reference.blueprintName.toLowerCase(),"reference"].join("_")}},valueFromReference:{value:function(t,a){t.blueprintName;var s=t.blueprintModuleId,l=t.prototypeName,u=t.moduleId,c=t.binderReference,d=n.resolve(i.Binder.manager.defaultBinder);c&&(d=o.valueFromReference(c,e));var h=n.defer();return d.then(function(t){if(t){var n=t.blueprintForPrototype(l,u);if(n)h.resolve(n);else try{r.Blueprint.getBlueprintWithModuleId(s,a).then(function(e){e?(t.addBlueprint(e),h.resolve(e)):h.reject(Error("Error cannot find Blueprint "+s))},h.reject)}catch(i){h.reject(Error("Error cannot find Blueprint "+s))}}else try{h=r.Blueprint.getBlueprintWithModuleId(s,e)}catch(i){h.reject(Error("Error cannot find Blueprint "+s))}}),h.promise}},referenceFromValue:{value:function(e){var t={};return t.blueprintName=e.name,t.blueprintModuleId=e.blueprintModuleId,t.prototypeName=e.prototypeName,t.moduleId=e.moduleId,e.binder&&!e.binder.isDefault&&(t.binderReference=o.referenceFromValue(e.binder)),t}}})}});